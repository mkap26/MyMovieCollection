<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Movie Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind to use Inter font
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* CSS for the flip animation */
        /* This container maintains the grid item's space */
        .movie-card-container {
            position: relative;
            width: 100%;
            padding-bottom: 150%; /* Maintains a 2:3 aspect ratio */
            perspective: 1000px;
        }
        
        /* This wrapper is absolutely positioned inside the container */
        .movie-card-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }
        
        .movie-card-wrapper.flipped {
            transform: rotateY(180deg);
        }
        
        .movie-card-front, .movie-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border-radius: 0.75rem;
            background-color: #ffffff;
        }
        .movie-card-back {
            transform: rotateY(180deg);
        }
        /* End of CSS for flip animation */

        /* CSS for the movie poster image */
        .poster-image {
            width: 100%;
            height: auto; /* Adjust height to maintain aspect ratio */
            border-radius: 0.75rem 0.75rem 0 0; /* Rounded top corners */
            object-fit: cover;
            margin-bottom: 0.5rem;
        }

        /* Specific styles for the List View */
        .movie-list-item {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: box-shadow 0.3s ease;
            position: relative;
        }
        .movie-list-item:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Responsive adjustments for list view content */
        .list-item-image {
            width: 50px; /* Small thumbnail size */
            height: 75px;
            object-fit: cover;
            border-radius: 0.25rem;
            flex-shrink: 0;
        }
        .list-item-details {
            flex-grow: 1;
            display: flex;
            flex-wrap: wrap; /* Allows details to wrap on small screens */
            gap: 0.5rem;
            margin-left: 1rem;
        }
        .list-item-title {
            font-weight: 600;
            color: #1f2937;
            width: 100%; /* Title always takes full width on mobile */
        }
        .list-item-detail {
            font-size: 0.75rem;
            color: #6b7280;
            white-space: nowrap;
        }
        .list-item-scores {
            display: flex;
            gap: 0.5rem;
        }
        @media (min-width: 640px) {
            .list-item-details {
                flex-wrap: nowrap; /* Prevent details from wrapping on larger screens */
                justify-content: space-between;
                align-items: center;
            }
            .list-item-title {
                width: auto;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <main class="max-w-7xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-6 sm:mb-8 text-center">My Movie Collection</h1>

        <div class="flex justify-center items-center mb-6">
            <button id="login-btn" class="px-6 py-3 bg-blue-500 text-white font-bold rounded-md shadow hover:bg-blue-600 transition-colors duration-200">
                Sign In with Google
            </button>
            <button id="signout-btn" class="px-6 py-3 bg-red-500 text-white font-bold rounded-md shadow hover:bg-red-600 transition-colors duration-200" style="display: none;">
                Sign Out
            </button>
        </div>

        <div id="authenticated-content" style="display: none;">
            <div class="flex flex-col lg:flex-row justify-between items-center bg-white p-4 sm:p-6 rounded-xl shadow-md mb-6 gap-4">
                
                <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto">
                    <div class="flex items-center space-x-2 w-full sm:w-auto">
                        <label for="sort-by" class="text-gray-700 font-medium whitespace-nowrap">Sort By:</label>
                        <select id="sort-by" class="p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full">
                            <option value="title" selected>Title</option>
                            <option value="year">Year</option>
                            <option value="rating">Rating</option>
                            <option value="length">Length</option>
                            <option value="genre">Genre</option>
                            <option value="tomatometer">Tomatometer</option>
                            <option value="audienceScore">Audience Score</option>
                            <option value="imdb">IMDb Score</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center space-x-2 w-full sm:w-auto">
                        <label for="filter-by-media" class="text-gray-700 font-medium whitespace-nowrap">Filter by Media:</label>
                        <select id="filter-by-media" class="p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full">
                            <option value="all">All</option>
                            <option value="4K Ultra HD">4K Ultra HD</option>
                            <option value="Blu-Ray">Blu-Ray</option>
                            <option value="DVD">DVD</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center space-x-2 w-full sm:w-auto">
                        <label for="filter-by-genre" class="text-gray-700 font-medium whitespace-nowrap">Filter by Genre:</label>
                        <select id="filter-by-genre" class="p-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full">
                            <option value="all">All</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                            <option value="Action">Action</option>
                            <option value="Drama">Drama</option>
                            <option value="Crime">Crime</option>
                            <option value="Not Rated">Not Rated</option>
                        </select>
                    </div>
                </div>

                <div class="flex items-center space-x-2 w-full sm:w-auto mt-4 sm:mt-0">
                    <span class="text-gray-700 font-medium whitespace-nowrap">View:</span>
                    <button data-view="list" class="view-btn px-3 py-1 bg-gray-200 text-gray-800 font-semibold rounded-md shadow hover:bg-gray-300 transition-colors duration-200">List</button>
                    <button data-view="grid" class="view-btn px-3 py-1 bg-blue-500 text-white font-semibold rounded-md shadow hover:bg-blue-600 transition-colors duration-200">Grid</button>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-2 w-full lg:w-auto mt-4 lg:mt-0">
                    <input type="text" id="search-input" placeholder="Search movies..." class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    <button id="sort-order" class="w-full sm:w-auto px-4 py-2 bg-blue-500 text-white font-semibold rounded-md shadow hover:bg-blue-600 transition-colors duration-200">
                        <span id="sort-order-text">Sort Ascending</span>
                    </button>
                    <button id="reset-filters" class="w-full sm:w-auto px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-md shadow hover:bg-gray-300 transition-colors duration-200">
                        Reset
                    </button>
                </div>
                
            </div>
            
            <div id="status-indicator" class="bg-white p-4 rounded-xl shadow-md text-gray-700 text-center mb-6">
                Please sign in to view your collection.
            </div>
            
            <div class="flex justify-center mb-6">
                <button id="add-movie-btn" class="px-6 py-3 bg-green-500 text-white font-bold rounded-md shadow hover:bg-green-600 transition-colors duration-200">Add New Movie</button>
            </div>

            <div id="movies-container" class="grid gap-6 grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5">
            </div>
        </div>
    </main>

    <div id="movie-modal-backdrop" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div id="movie-modal" class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md transform scale-95 transition-all duration-300">
            <h2 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4">Add New Movie</h2>
            <form id="movie-form" class="space-y-4">
                <div>
                    <label for="movie-title" class="block text-sm font-medium text-gray-700">Title</label>
                    <input type="text" id="movie-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="movie-year" class="block text-sm font-medium text-gray-700">Year</label>
                    <input type="number" id="movie-year" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="movie-rating" class="block text-sm font-medium text-gray-700">Rating</label>
                    <select id="movie-rating" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="G">G</option>
                        <option value="PG">PG</option>
                        <option value="PG-13">PG-13</option>
                        <option value="R">R</option>
                        <option value="NC-17">NC-17</option>
                        <option value="Not Rated">Not Rated</option>
                    </select>
                </div>
                <div>
                    <label for="movie-length" class="block text-sm font-medium text-gray-700">Length (minutes)</label>
                    <input type="number" id="movie-length" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div>
                    <label for="movie-genre" class="block text-sm font-medium text-gray-700">Genre</label>
                    <input type="text" id="movie-genre" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div>
                    <label for="movie-tomatometer" class="block text-sm font-medium text-gray-700">Tomatometer (%)</label>
                    <input type="number" id="movie-tomatometer" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" min="0" max="100">
                </div>
                <div>
                    <label for="movie-audience-score" class="block text-sm font-medium text-gray-700">Audience Score (%)</label>
                    <input type="number" id="movie-audience-score" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" min="0" max="100">
                </div>
                <div>
                    <label for="movie-imdb" class="block text-sm font-medium text-gray-700">IMDb Score (/10)</label>
                    <input type="number" id="movie-imdb" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" step="0.1" min="0" max="10">
                </div>
                <div>
                    <label for="movie-media" class="block text-sm font-medium text-gray-700">Media Type</label>
                    <select id="movie-media" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="4K Ultra HD">4K Ultra HD</option>
                        <option value="Blu-Ray">Blu-Ray</option>
                        <option value="DVD">DVD</option>
                    </select>
                </div>
                <div>
                    <label for="movie-image-url" class="block text-sm font-medium text-gray-700">Image URL (Optional)</label>
                    <input type="url" id="movie-image-url" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div class="flex justify-between items-center mt-6">
                    <button type="button" id="delete-movie-btn" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-md shadow hover:bg-red-600 transition-colors duration-200" style="display: none;">Delete Movie</button>
                    <div class="flex space-x-2 ml-auto">
                        <button type="button" id="cancel-modal-btn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-md shadow hover:bg-gray-300 transition-colors duration-200">Cancel</button>
                        <button type="submit" id="save-movie-btn" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-md shadow hover:bg-blue-600 transition-colors duration-200">Add Movie</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, addDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBf9ZHgLHkIIIH9-C9etHGMf8xTno2K9u8",
            authDomain: "my-movie-collection-1ed74.firebaseapp.com",
            projectId: "my-movie-collection-1ed74",
            storageBucket: "my-movie-collection-1ed74.firebasestorage.app",
            messagingSenderId: "513133972702",
            appId: "1:513133972702:web:f0d4cfbb018f9e815a864f",
            measurementId: "G-S41SMHF1WD"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        let moviesCollectionRef;
        let allMovies = [];
        let isAscending = true;
        let currentEditingMovieId = null;
        let currentView = 'grid';

        const defaultMoviesData = `
        [{ "title": "10 Cloverfield Lane", "year": 2016, "tomatometer": 91, "audienceScore": 79, "imdb": 7.2, "media": "4K Ultra HD", "rating": "PG-13", "length": 103, "genre": "Sci-Fi", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=10+Cloverfield+Lane" },
            { "title": "American Sniper", "year": 2014, "tomatometer": 34, "audienceScore": 85, "imdb": 7.3, "media": "4K Ultra HD", "rating": "R", "length": 133, "genre": "Action", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=American+Sniper" },
            { "title": "Back to the Future", "year": 1985, "tomatometer": 93, "audienceScore": 95, "imdb": 8.5, "media": "4K Ultra HD", "rating": "PG", "length": 116, "genre": "Sci-Fi", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=Back+to+the+Future" },
            { "title": "Batman Begins", "year": 2005, "tomatometer": 84, "audienceScore": 89, "imdb": 8.2, "media": "4K Ultra HD", "rating": "PG-13", "length": 140, "genre": "Action", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=Batman+Begins" },
            { "title": "Dune (2021)", "year": 2021, "tomatometer": 83, "audienceScore": 90, "imdb": 8.0, "media": "4K Ultra HD", "rating": "PG-13", "length": 155, "genre": "Sci-Fi", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=Dune" },
            { "title": "Gladiator", "year": 2000, "tomatometer": 76, "audienceScore": 86, "imdb": 8.5, "media": "DVD", "rating": "R", "length": 155, "genre": "Action", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=Gladiator" },
            { "title": "The Departed", "year": 2006, "tomatometer": 91, "audienceScore": 94, "imdb": 8.5, "media": "Blu-Ray", "rating": "R", "length": 151, "genre": "Crime", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=The+Departed" },
            { "title": "The Shawshank Redemption", "year": 1994, "tomatometer": 91, "audienceScore": 96, "imdb": 9.3, "media": "4K Ultra HD", "rating": "R", "length": 142, "genre": "Drama", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=The+Shawshank+Redemption" },
            { "title": "The Dark Knight", "year": 2008, "tomatometer": 94, "audienceScore": 94, "imdb": 9.0, "media": "4K Ultra HD", "rating": "PG-13", "length": 152, "genre": "Action", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=The+Dark+Knight" },
            { "title": "Pulp Fiction", "year": 1994, "tomatometer": 92, "audienceScore": 96, "imdb": 8.9, "media": "Blu-Ray", "rating": "R", "length": 154, "genre": "Crime", "imageUrl": "https://placehold.co/300x450/e0e0e0/555555?text=Pulp+Fiction" }
        ]`;

        function createMovieCard(movie, isListView = false) {
            if (isListView) {
                const listItem = document.createElement('div');
                listItem.classList.add('movie-list-item', 'relative', 'group', 'p-4', 'flex', 'flex-col', 'sm:flex-row', 'sm:items-center', 'sm:justify-between');
                listItem.setAttribute('data-movie-id', movie.id);

                const leftSection = document.createElement('div');
                leftSection.classList.add('flex', 'items-center', 'space-x-4', 'w-full', 'sm:w-auto');
                
                const image = document.createElement('img');
                image.src = movie.imageUrl || `https://placehold.co/50x75/e0e0e0/555555?text=No+Image`;
                image.alt = `Poster for ${movie.title}`;
                image.classList.add('list-item-image');
                leftSection.appendChild(image);
                
                const title = document.createElement('span');
                title.textContent = `${movie.title} (${movie.year})`;
                title.classList.add('list-item-title');
                leftSection.appendChild(title);
                
                listItem.appendChild(leftSection);

                const detailsSection = document.createElement('div');
                detailsSection.classList.add('list-item-details');
                
                const rating = document.createElement('span');
                rating.textContent = `Rating: ${movie.rating || 'N/A'}`;
                rating.classList.add('list-item-detail');
                detailsSection.appendChild(rating);
                
                const length = document.createElement('span');
                length.textContent = `Length: ${movie.length ? `${movie.length} min` : 'N/A'}`;
                length.classList.add('list-item-detail');
                detailsSection.appendChild(length);
                
                const genre = document.createElement('span');
                genre.textContent = `Genre: ${movie.genre || 'N/A'}`;
                genre.classList.add('list-item-detail');
                detailsSection.appendChild(genre);
                
                const media = document.createElement('span');
                media.textContent = `Media: ${movie.media}`;
                media.classList.add('list-item-detail');
                detailsSection.appendChild(media);

                const scoresDiv = document.createElement('div');
                scoresDiv.classList.add('list-item-scores');
                
                const tomatometer = document.createElement('span');
                tomatometer.textContent = `🍅 ${movie.tomatometer}%`;
                tomatometer.classList.add('list-item-detail');
                scoresDiv.appendChild(tomatometer);
                
                const audience = document.createElement('span');
                audience.textContent = `🍿 ${movie.audienceScore}%`;
                audience.classList.add('list-item-detail');
                scoresDiv.appendChild(audience);
                
                const imdb = document.createElement('span');
                imdb.textContent = `⭐ ${movie.imdb}/10`;
                imdb.classList.add('list-item-detail');
                scoresDiv.appendChild(imdb);

                detailsSection.appendChild(scoresDiv);
                
                listItem.appendChild(detailsSection);

                const editButton = document.createElement('button');
                editButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 hover:text-blue-500 transition-colors" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-4.757 1.586l-2.828 2.828-6.172 6.172a2 2 0 00-.586 1.414V17a1 1 0 001 1h4.172a2 2 0 001.414-.586l6.172-6.172-2.828-2.828-6.172 6.172z" />
                    </svg>
                `;
                editButton.classList.add('absolute', 'top-1/2', '-translate-y-1/2', 'right-4', 'p-1', 'opacity-0', 'group-hover:opacity-100', 'transition-opacity', 'duration-200');
                editButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openModalForEdit(movie.id);
                });
                listItem.appendChild(editButton);
                
                return listItem;
            } else {
                // Corrected Grid View Card with Wrapper
                const cardContainer = document.createElement('div');
                cardContainer.classList.add('movie-card-container');

                const cardWrapper = document.createElement('div');
                cardWrapper.classList.add('movie-card-wrapper');
                
                const cardFront = document.createElement('div');
                cardFront.classList.add('movie-card-front', 'bg-white', 'rounded-xl', 'shadow-md', 'hover:shadow-lg', 'transition-shadow', 'duration-300', 'flex', 'flex-col', 'relative');
                
                const editButton = document.createElement('button');
                editButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 hover:text-blue-500 transition-colors" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-4.757 1.586l-2.828 2.828-6.172 6.172a2 2 0 00-.586 1.414V17a1 1 0 001 1h4.172a2 2 0 001.414-.586l6.172-6.172-2.828-2.828-6.172 6.172z" />
                    </svg>
                `;
                editButton.classList.add('absolute', 'top-4', 'right-4', 'p-1', 'rounded-full', 'bg-white', 'hover:bg-gray-100', 'transition-colors', 'duration-200');
                editButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openModalForEdit(movie.id);
                });
                cardFront.appendChild(editButton);

                const image = document.createElement('img');
                image.src = movie.imageUrl || `https://placehold.co/300x450
